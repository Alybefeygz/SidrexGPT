# Generated by Django 5.1.6 on 2025-07-10 12:23

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('robots', '0021_add_performance_indexes'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ChatSession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('session_id', models.CharField(help_text="Frontend'den gelen unique session ID", max_length=100, verbose_name='Oturum ID')),
                ('started_at', models.DateTimeField(auto_now_add=True, verbose_name='BaÅŸlangÄ±Ã§ ZamanÄ±')),
                ('ended_at', models.DateTimeField(blank=True, null=True, verbose_name='BitiÅŸ ZamanÄ±')),
                ('is_active', models.BooleanField(default=True, verbose_name='Aktif mi?')),
                ('total_messages', models.PositiveIntegerField(default=0, verbose_name='Toplam Mesaj SayÄ±sÄ±')),
                ('total_response_time', models.DecimalField(decimal_places=3, default=0.0, max_digits=10, verbose_name='Toplam YanÄ±t SÃ¼resi (saniye)')),
                ('average_response_time', models.DecimalField(decimal_places=3, default=0.0, max_digits=8, verbose_name='Ortalama YanÄ±t SÃ¼resi (saniye)')),
                ('user_ip', models.GenericIPAddressField(blank=True, null=True, verbose_name='KullanÄ±cÄ± IP')),
                ('user_agent', models.TextField(blank=True, null=True, verbose_name='User Agent')),
                ('robot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_sessions', to='robots.robot', verbose_name='Robot')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_sessions', to=settings.AUTH_USER_MODEL, verbose_name='KullanÄ±cÄ±')),
            ],
            options={
                'verbose_name': 'Chat Oturumu',
                'verbose_name_plural': 'Chat OturumlarÄ±',
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='ChatMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('message_type', models.CharField(choices=[('user', 'KullanÄ±cÄ± MesajÄ±'), ('assistant', 'AI YanÄ±tÄ±')], max_length=10, verbose_name='Mesaj TÃ¼rÃ¼')),
                ('user_message', models.TextField(verbose_name='KullanÄ±cÄ± MesajÄ±')),
                ('ai_response', models.TextField(blank=True, null=True, verbose_name='AI YanÄ±tÄ±')),
                ('response_time', models.DecimalField(blank=True, decimal_places=3, max_digits=8, null=True, verbose_name='YanÄ±t SÃ¼resi (saniye)')),
                ('processing_started_at', models.DateTimeField(blank=True, null=True, verbose_name='Ä°ÅŸlem BaÅŸlangÄ±Ã§ ZamanÄ±')),
                ('processing_ended_at', models.DateTimeField(blank=True, null=True, verbose_name='Ä°ÅŸlem BitiÅŸ ZamanÄ±')),
                ('status', models.CharField(choices=[('processing', 'Ä°ÅŸleniyor'), ('completed', 'TamamlandÄ±'), ('failed', 'BaÅŸarÄ±sÄ±z'), ('timeout', 'Zaman AÅŸÄ±mÄ±')], default='processing', max_length=15, verbose_name='Durum')),
                ('ai_model_used', models.CharField(blank=True, max_length=100, null=True, verbose_name='KullanÄ±lan AI Modeli')),
                ('tokens_used', models.PositiveIntegerField(blank=True, null=True, verbose_name='KullanÄ±lan Token SayÄ±sÄ±')),
                ('optimization_enabled', models.BooleanField(default=False, verbose_name='Optimizasyon AÃ§Ä±k mÄ±ydÄ±?')),
                ('context_used', models.BooleanField(default=False, verbose_name='Context KullanÄ±ldÄ± mÄ±?')),
                ('context_size', models.PositiveIntegerField(blank=True, null=True, verbose_name='Context Boyutu (karakter)')),
                ('citations_count', models.PositiveIntegerField(default=0, verbose_name='AlÄ±ntÄ± SayÄ±sÄ±')),
                ('error_message', models.TextField(blank=True, null=True, verbose_name='Hata MesajÄ±')),
                ('error_type', models.CharField(blank=True, max_length=50, null=True, verbose_name='Hata TÃ¼rÃ¼')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='OluÅŸturulma ZamanÄ±')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='IP Adresi')),
                ('user_feedback', models.IntegerField(blank=True, choices=[(1, 'ğŸ‘ KÃ¶tÃ¼'), (2, 'ğŸ˜ Orta'), (3, 'ğŸ‘ Ä°yi')], null=True, verbose_name='KullanÄ±cÄ± Geri Bildirimi')),
                ('admin_notes', models.TextField(blank=True, null=True, verbose_name='Admin NotlarÄ±')),
                ('robot', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_messages', to='robots.robot', verbose_name='Robot')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_messages', to=settings.AUTH_USER_MODEL, verbose_name='KullanÄ±cÄ±')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chat_messages', to='robots.chatsession', verbose_name='Chat Oturumu')),
            ],
            options={
                'verbose_name': 'Chat MesajÄ±',
                'verbose_name_plural': 'Chat MesajlarÄ±',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='chatsession',
            index=models.Index(fields=['user', 'robot', 'started_at'], name='robots_chat_user_id_1b244c_idx'),
        ),
        migrations.AddIndex(
            model_name='chatsession',
            index=models.Index(fields=['session_id'], name='robots_chat_session_b3dfe6_idx'),
        ),
        migrations.AddIndex(
            model_name='chatsession',
            index=models.Index(fields=['started_at'], name='robots_chat_started_cf35d8_idx'),
        ),
        migrations.AddIndex(
            model_name='chatmessage',
            index=models.Index(fields=['user', 'robot', 'created_at'], name='robots_chat_user_id_9d723c_idx'),
        ),
        migrations.AddIndex(
            model_name='chatmessage',
            index=models.Index(fields=['session', 'created_at'], name='robots_chat_session_39df91_idx'),
        ),
        migrations.AddIndex(
            model_name='chatmessage',
            index=models.Index(fields=['status'], name='robots_chat_status_b760b2_idx'),
        ),
        migrations.AddIndex(
            model_name='chatmessage',
            index=models.Index(fields=['response_time'], name='robots_chat_respons_eab412_idx'),
        ),
        migrations.AddIndex(
            model_name='chatmessage',
            index=models.Index(fields=['created_at'], name='robots_chat_created_8840dd_idx'),
        ),
    ]
